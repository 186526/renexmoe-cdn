function E(n){try{new URL(n)}catch(c){return}if(new URL(n).host!==window.location.host)return;let r=window.location.protocol+"//"+window.location.host;if(new URL(n).search==="?preview")return r+new URL(n).pathname+"?preview";let i="/";for(let c of new URL(n).pathname.split("/").slice(1,-1))i=i+c+"/";return r+i}function C(){const n=new Set,r=new Set,i=document.createElement("link"),c=i.relList&&i.relList.supports&&i.relList.supports("prefetch")&&window.IntersectionObserver&&"isIntersecting"in IntersectionObserverEntry.prototype,v=navigator.connection&&(navigator.connection.saveData||(navigator.connection.effectiveType||"").includes("2g"));if(v||!c)return;const p=e=>new Promise((t,s)=>{const o=document.createElement("link");o.rel="prefetch",o.href=E(e),o.onload=t,o.onerror=s,console.log(`renexmoe - FlyingPages - Preload ${o.href}`),document.head.appendChild(o)}),u=e=>{const t=setTimeout(()=>g(),5e3);p(e).catch(()=>g()).finally(()=>clearTimeout(t))},a=(e,t=!1)=>{if(r.has(e)||n.has(e))return;const s=window.location.origin;if(e.substring(0,s.length)!==s)return;if(window.location.href===e)return;for(let o=0;o<window.FPConfig.ignoreKeywords.length;o++)if(e.includes(window.FPConfig.ignoreKeywords[o]))return;t?(u(e),r.add(e)):n.add(e)},d=new IntersectionObserver(e=>{e.forEach(t=>{if(t.isIntersecting){const s=t.target.href;a(s,!window.FPConfig.maxRPS)}})}),P=()=>setInterval(()=>{Array.from(n).slice(0,window.FPConfig.maxRPS).forEach(e=>{u(e),r.add(e),n.delete(e)})},1e3);let f=null;const h=e=>{const t=e.target.closest("a");t&&t.href&&!r.has(t.href)&&(f=setTimeout(()=>{a(t.href,!0)},window.FPConfig.hoverDelay))},w=e=>{const t=e.target.closest("a");t&&t.href&&!r.has(t.href)&&a(t.href,!0)},m=e=>{const t=e.target.closest("a");t&&t.href&&!r.has(t.href)&&clearTimeout(f)},y=window.requestIdleCallback||function(e){const t=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},g=()=>{document.querySelectorAll("a").forEach(e=>d.unobserve(e)),n.clear(),document.removeEventListener("mouseover",h,!0),document.removeEventListener("mouseout",m,!0),document.removeEventListener("touchstart",w,!0)},L={delay:0,ignoreKeywords:[],maxRPS:3,hoverDelay:50};window.FPConfig=Object.assign(L,window.FPConfig),P(),y(()=>setTimeout(()=>document.querySelectorAll("a").forEach(e=>d.observe(e)),window.FPConfig.delay*1e3));const l={capture:!0,passive:!0};document.addEventListener("mouseover",h,l),document.addEventListener("mouseout",m,l),document.addEventListener("touchstart",w,l)}export default()=>{C()};
